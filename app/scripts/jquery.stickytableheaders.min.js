(function(e,i){"use strict";function t(t,a){var s=this;s.$el=e(t),s.el=t,s.id=o++,s.$el.bind("destroyed",e.proxy(s.teardown,s)),s.$clonedHeader=null,s.$originalHeader=null,s.isSticky=!1,s.hasBeenSticky=!1,s.leftOffset=null,s.topOffset=null,s.init=function(){s.options=e.extend({},n,a),s.$el.each(function(){var i=e(this);i.css("padding",0),s.$scrollableArea=e(s.options.scrollableArea),s.$originalHeader=e("thead:first",this),s.$clonedHeader=s.$originalHeader.clone(),i.trigger("clonedHeader."+l,[s.$clonedHeader]),s.$clonedHeader.addClass("tableFloatingHeader"),s.$clonedHeader.css("display","none"),s.$originalHeader.addClass("tableFloatingHeaderOriginal"),s.$originalHeader.after(s.$clonedHeader),s.$printStyle=e('<style type="text/css" media="print">.tableFloatingHeader{display:none !important;}.tableFloatingHeaderOriginal{position:static !important;}</style>'),e("head").append(s.$printStyle)}),s.updateWidth(),s.toggleHeaders(),s.bind()},s.destroy=function(){s.$el.unbind("destroyed",s.teardown),s.teardown()},s.teardown=function(){s.isSticky&&s.$originalHeader.css("position","static"),e.removeData(s.el,"plugin_"+l),s.unbind(),s.$clonedHeader.remove(),s.$originalHeader.removeClass("tableFloatingHeaderOriginal"),s.$originalHeader.css("visibility","visible"),s.$printStyle.remove(),s.el=null,s.$el=null},s.bind=function(){s.$scrollableArea.on("scroll."+l,s.toggleHeaders),s.isWindowScrolling()||(e(i).on("scroll."+l+s.id,s.setPositionValues),e(i).on("resize."+l+s.id,s.toggleHeaders)),s.$scrollableArea.on("resize."+l,s.toggleHeaders),s.$scrollableArea.on("resize."+l,s.updateWidth)},s.unbind=function(){s.$scrollableArea.off("."+l,s.toggleHeaders),s.isWindowScrolling()||(e(i).off("."+l+s.id,s.setPositionValues),e(i).off("."+l+s.id,s.toggleHeaders)),s.$scrollableArea.off("."+l,s.updateWidth),s.$el.off("."+l),s.$el.find("*").off("."+l)},s.toggleHeaders=function(){s.$el&&s.$el.each(function(){var i,t=e(this),l=s.isWindowScrolling()?isNaN(s.options.fixedOffset)?s.options.fixedOffset.outerHeight():s.options.fixedOffset:s.$scrollableArea.offset().top+(isNaN(s.options.fixedOffset)?0:s.options.fixedOffset),o=t.offset(),n=s.$scrollableArea.scrollTop()+l,a=s.$scrollableArea.scrollLeft(),d=s.isWindowScrolling()?n>o.top:l>o.top,r=(s.isWindowScrolling()?n:0)<o.top+t.height()-s.$clonedHeader.height()-(s.isWindowScrolling()?0:l);d&&r?(i=o.left-a+s.options.leftOffset,s.$originalHeader.css({position:"fixed","margin-top":0,left:i,"z-index":1}),s.isSticky=!0,s.leftOffset=i,s.topOffset=l,s.$clonedHeader.css("display",""),s.setPositionValues(),s.updateWidth()):s.isSticky&&(s.$originalHeader.css("position","static"),s.$clonedHeader.css("display","none"),s.isSticky=!1,s.resetWidth(e("td,th",s.$clonedHeader),e("td,th",s.$originalHeader)))})},s.isWindowScrolling=function(){return s.$scrollableArea[0]===i},s.setPositionValues=function(){var t=e(i).scrollTop(),l=e(i).scrollLeft();!s.isSticky||0>t||t+e(i).height()>e(document).height()||0>l||l+e(i).width()>e(document).width()||s.$originalHeader.css({top:s.topOffset-(s.isWindowScrolling()?0:t),left:s.leftOffset-(s.isWindowScrolling()?0:l)})},s.updateWidth=function(){if(s.isSticky){s.$originalHeaderCells||(s.$originalHeaderCells=e("th,td",s.$originalHeader)),s.$clonedHeaderCells||(s.$clonedHeaderCells=e("th,td",s.$clonedHeader));var i=s.getWidth(s.$clonedHeaderCells);s.setWidth(i,s.$clonedHeaderCells,s.$originalHeaderCells),s.$originalHeader.css("width",s.$clonedHeader.width())}},s.getWidth=function(i){var t=[];return i.each(function(i){var l,o=e(this);if("border-box"===o.css("box-sizing"))l=o.outerWidth();else{var n=e("th",s.$originalHeader);if("collapse"===n.css("border-collapse"))if(document.defaultView&&document.defaultView.getComputedStyle)l=parseFloat(document.defaultView.getComputedStyle(this,null).width);else{var a=parseFloat(o.css("padding-left")),d=parseFloat(o.css("padding-right")),r=parseFloat(o.css("border-width"));l=o.outerWidth()-a-d-r}else l=o.width()}t[i]=l}),t},s.setWidth=function(e,i,t){i.each(function(i){var l=e[i];t.eq(i).css({"min-width":l,"max-width":l})})},s.resetWidth=function(i,t){i.each(function(i){var l=e(this);t.eq(i).css({"min-width":l.css("min-width"),"max-width":l.css("max-width")})})},s.updateOptions=function(i){s.options=e.extend({},n,i),s.updateWidth(),s.toggleHeaders()},s.init()}var l="stickyTableHeaders",o=0,n={fixedOffset:0,leftOffset:0,scrollableArea:i};e.fn[l]=function(i){return this.each(function(){var o=e.data(this,"plugin_"+l);o?"string"==typeof i?o[i].apply(o):o.updateOptions(i):"destroy"!==i&&e.data(this,"plugin_"+l,new t(this,i))})}})(jQuery,window);